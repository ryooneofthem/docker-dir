web:
    build: web
    #links: 
    #    - app
    ports:
        - "80:80"
    volumes:
        - /dev/shm:/www:ro
        - web/default.tmpl:/etc/nginx/conf.d/default.tmpl
        - web/conf/nginx.conf:/etc/nginx/nginx.conf:ro
    net: "host"

app:
    build: app
    environment:
        #- MONGODB_URL=mongodb://db:27017/my_db
        - MONGODB_URL=mongodb://docker-db1/my_db
    working_dir: /cross-platform
    volumes:
        - /etc/hosts:/etc/hosts
        - app/config:/etc/supervisor/conf.d
        - app/cross-platform/gunicorn.ini:/cross-platform/gunicorn.ini:ro
    expose:
        - "8080"

db:
    image: mongo:latest
    ports:
        - "27017:27017"
    volumes:
        - /tmp:/data/db
        - /etc/hosts:/etc/hosts
    #    - ~/WORK/benchmark/db/tmp:/tmp
    #command: mongod --nojournal --smallfiles
    command: mongod --smallfiles

jmeter:
    image: sampritavh/jmeter
    volumes:
        - jmeter:/tmp
    command: bash -c "jmeter-server & jmeter -n -t /tmp/jmeter-senario1.jmx -r"
